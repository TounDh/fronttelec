<div class="container-xxl py-5 hero-header mb-5">
  <div class="container my-5 py-5 px-lg-5">
    <div class="row g-5 py-5">
      <div class="col-12 text-center">
        <h1 class="text-white animated zoomIn">My Account</h1>
        <hr class="bg-white mx-auto mt-0" style="width: 90px;">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-center">
            <li class="breadcrumb-item"><a class="text-white" href="#">Home</a></li>
            <li class="breadcrumb-item"><a class="text-white" href="#">Pages</a></li>
            <li class="breadcrumb-item text-white active" aria-current="page">My Account</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
</div>

<div class="container-xxl py-5">
  <div class="container px-lg-5">
    <div class="section-title position-relative text-center mb-5 pb-2 wow fadeInUp" data-wow-delay="0.1s">
      <h6 class="position-relative d-inline text-primary ps-4">My account</h6>
      <img src="assets/img/usr.png" alt="User Image" class="img-fluid mx-auto d-block mt-3 mb-3" style="max-width: 100px;">
      <h2 class="mt-2">Manage your account</h2>
    </div>
    <div class="row mt-n2 wow fadeInUp" data-wow-delay="0.1s">
      <div class="col-12 text-center">
        <ul class="list-inline mb-5" id="portfolio-flters">
          <li class="btn px-3 pe-4" [class.active]="activeSection === 'details'" (click)="setActiveSection('details')">Details</li>
          <li class="btn px-3 pe-4" [class.active]="activeSection === 'address'" (click)="setActiveSection('address')">Address</li>
          <li class="btn px-3 pe-4" [class.active]="activeSection === 'applications'" (click)="setActiveSection('applications')">Applications</li>
          <li class="btn px-3 pe-4" [class.active]="activeSection === 'payments'" (click)="setActiveSection('payments')">Payments</li>
          <li class="btn px-3 pe-4" [class.active]="activeSection === 'installations'" (click)="setActiveSection('installations')">Installations</li>
        </ul>
      </div>
    </div>
    <div class="row g-4 portfolio-container">
















      <!-- Details Section -->
      <!-- Only change the Details Section - keep everything else exactly the same -->
<div class="col-12 portfolio-item" *ngIf="activeSection === 'details'" data-wow-delay="0.1s">
  <div class="card border-0 shadow-sm">
    <div class="card-body">
      <h4 class="card-title">User Personal Details</h4>
      
      <!-- Loading state -->
      <div *ngIf="isLoading" class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <!-- User details -->
      <ul *ngIf="!isLoading && currentUser" class="list-group list-group-flush">
<li class="list-group-item"><strong>Name:</strong> {{ currentUser.name }}</li>
<li class="list-group-item"><strong>Surname:</strong> {{ currentUser.surname }}</li>
<li class="list-group-item"><strong>Email:</strong> {{ currentUser.email }}</li>
<li class="list-group-item">
  <strong>Telephone:</strong> 
  {{ currentUser?.phone || 'Not available' }}
</li>
<li class="list-group-item">
  <strong>Date of Birth:</strong> 
  {{ currentUser?.birthdate || 'Not available' }}
</li>

      </ul>

      <!-- No user data message -->
      <div *ngIf="!isLoading && !currentUser" class="alert alert-info">
        No user data available. Please log in again.
      </div>

      <div class="mt-3 text-end">
        <button class="edit-btn" (click)="showEditModal = true">Edit</button>
      </div>
    </div>
  </div>
</div>














<!-- KEEP EVERYTHING ELSE EXACTLY THE SAME - DON'T MODIFY ANY OTHER SECTIONS -->



 <!-- Address Section -->
<div class="col-12 portfolio-item" *ngIf="activeSection === 'address'" data-wow-delay="0.2s">
  <div class="card border-0 shadow-sm">
    <div class="card-body">
      <h4 class="card-title">User Address</h4>
      
      <!-- Loading state -->
      <div *ngIf="isLoadingAddress" class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <!-- No address message -->
      <div *ngIf="!isLoadingAddress && !userAddress" class="alert alert-info">
        No address found. Please add your address.
      </div>

      <!-- Address display -->
      <div *ngIf="!isLoadingAddress && userAddress" class="row">
        <div class="col-md-6">
          <ul class="list-group list-group-flush">
            <li class="list-group-item"><strong>Street:</strong> {{ userAddress.street }}</li>
            <li class="list-group-item"><strong>Governorate:</strong> {{ userAddress.governorate }}</li>
            <li class="list-group-item"><strong>City:</strong> {{ userAddress.city }}</li>
            <li class="list-group-item"><strong>Zip Code:</strong> {{ userAddress.zipCode }}</li>
            <li class="list-group-item"><strong>Country:</strong> {{ userAddress.country }}</li>
            <li class="list-group-item" *ngIf="userAddress.latitude && userAddress.longitude">
              <strong>Coordinates:</strong> {{ userAddress.latitude }}, {{ userAddress.longitude }}
            </li>
          </ul>
        </div>
        <div class="col-md-6">
          <div class="map-container">
            <div id="map" style="height: 300px; border-radius: 8px;">
              <div *ngIf="!userAddress.latitude || !userAddress.longitude" class="text-center p-5">
                <i class="fas fa-map-marker-alt fa-3x text-muted mb-3"></i>
                <p>Check Google Maps to retrieve your longitude and latitude</p>
              </div>
              <div *ngIf="userAddress.latitude && userAddress.longitude" id="map-content" style="height: 100%"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action buttons -->
      <div class="mt-3 text-end">
        <button class="btn btn-primary me-2" (click)="showAddAddressModal = true" *ngIf="!userAddress">
          Add Address
        </button>
        <button class="btn btn-primary me-2" (click)="openEditAddressModal()" *ngIf="userAddress">
          Edit Address
        </button>
        
      </div>
    </div>
  </div>
</div>








      




      <!-- Applications Section -->
      <!-- Applications Section -->
<!-- Applications Section -->
<div class="col-12 portfolio-item" *ngIf="activeSection === 'applications'" data-wow-delay="0.3s">
  <div class="card border-0 shadow-sm">
    <div class="card-body">
      <h4 class="card-title">Applications</h4>
      
      <!-- Loading state -->
      <div *ngIf="isLoadingApplications" class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <!-- No applications message -->
      <div *ngIf="!isLoadingApplications && (!userApplications || userApplications.length === 0)" class="alert alert-info">
        You haven't submitted any applications yet.
      </div>

      <!-- All Applications - Recent on top, others in table -->
      <div *ngIf="!isLoadingApplications && userApplications && userApplications.length > 0">
        <!-- Recent Application (most recent) -->
        <div class="card mb-4 border-0 recent-card">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Recent Application</h5>
          </div>
          <div class="card-body">
            <p><strong>Application ID:</strong> {{ userApplications[0].id }}</p>
            <p><strong>Service:</strong> {{ userApplications[0].srvce?.name || 'N/A' }}</p>
            <p><strong>Offer:</strong> {{ userApplications[0].offer?.speed || 'N/A' }} Mbps - ${{ userApplications[0].offer?.price || 'N/A' }}</p>
            <p><strong>Status:</strong> 
              <span [ngClass]="{
                'badge bg-pending': userApplications[0].status === 'PENDING',
                'badge bg-accepted': userApplications[0].status === 'APPROVED',
                'badge bg-rejected': userApplications[0].status === 'REJECTED'
              }">
                {{ userApplications[0].status }}
              </span>
            </p>
            <p><strong>Application Date:</strong> {{ formatDate(userApplications[0].applicationDate) }}</p>
          </div>
        </div>

        <!-- All Other Applications in a table -->
        <h5 class="mb-3">All Applications</h5>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead class="table-header">
              <tr>
                <th>ID</th>
                <th>Service</th>
                <th>Offer</th>
                <th>Status</th>
                <th>Application Date</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let application of userApplications">
                <td>{{ application.id }}</td>
                <td>{{ application.srvce?.name || 'N/A' }}</td>
                <td>{{ application.offer?.speed || 'N/A' }} Mbps - ${{ application.offer?.price || 'N/A' }}</td>
                <td>
                  <span [ngClass]="{
                    'badge bg-pending': application.status === 'PENDING',
                    'badge bg-accepted': application.status === 'APPROVED',
                    'badge bg-rejected': application.status === 'REJECTED'
                  }">
                    {{ application.status }}
                  </span>
                </td>
                <td>{{ formatDate(application.applicationDate) }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>









      
      <!-- Payments Section -->
       <!--please my friend deapseek respect this layout but at the same time add what is necessary to only display past payments for this current user and at recent approved section display the recent payment only and dont add logic for pay now button now -->
      <!-- Payments Section -->
<div class="col-12 portfolio-item" *ngIf="activeSection === 'payments'" data-wow-delay="0.4s">
  <div class="card border-0 shadow-sm">
    <div class="card-body">
      <h4 class="card-title">Payments</h4>
      
      <!-- Loading state -->
      <div *ngIf="isLoadingPayments" class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <!-- No payments message -->
      <div *ngIf="!isLoadingPayments && (!userPayments || userPayments.length === 0)" class="alert alert-info">
        No payments found.
      </div>

      <div *ngIf="!isLoadingPayments && userPayments && userPayments.length > 0">
        <!-- Recent Payment (most recent) -->
        <div class="card mb-4 border-0 recent-card" *ngIf="recentPayment">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Recent Payment</h5>
          </div>
          <div class="card-body d-flex flex-column">
            <div>
              <p><strong>Service:</strong> {{ recentPayment.application?.srvce?.name || 'N/A' }}</p>
              <p><strong>Status:</strong> 
                <span [ngClass]="{
                  'badge bg-pending': recentPayment.status === 'PENDING',
                  'badge bg-accepted': recentPayment.status === 'PAID',
                  'badge bg-rejected': recentPayment.status === 'OVERDUE'
                }">
                  {{ recentPayment.status }}
                </span>
              </p>
              <p><strong>Due Date:</strong> {{ formatDate(recentPayment.deadline) }}</p>
              <p><strong>Amount:</strong> ${{ recentPayment.total }}</p>
            </div>
            <div class="mt-auto align-self-end">
              <button class="pay-now-btn" data-bs-toggle="modal" data-bs-target="#paymentModal">Pay Now</button>
            </div>
          </div>
        </div>

        <!-- Payment History -->
        <h5 class="mb-3">Payment History</h5>
        <div class="table-responsive">
          <table class="table table-striped">
            <thead class="table-header">
              <tr>
                <th>Service</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Due Date</th>
                <th>Paid Date</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let payment of userPayments">
                <td>{{ payment.application?.srvce?.name || 'N/A' }}</td>
                <td>${{ payment.total }}</td>
                <td>
                  <span [ngClass]="{
                    'badge bg-pending': payment.status === 'PENDING',
                    'badge bg-accepted': payment.status === 'PAID',
                    'badge bg-rejected': payment.status === 'OVERDUE'
                  }">
                    {{ payment.status }}
                  </span>
                </td>
                <td>{{ formatDate(payment.deadline) }}</td>
                <td>{{ payment.status === 'PAID' ? formatDate(payment.paidDate) : '-' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

















      <!-- Installations Section -->
      <div class="col-12 portfolio-item" *ngIf="activeSection === 'installations'" data-wow-delay="0.5s">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h4 class="card-title">Installations</h4>
            <!-- Next Installation -->
            <div class="card mb-4 border-0 recent-card">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Next Installation</h5>
              </div>
              <div class="card-body">
                <p><strong>Service:</strong> Internet Plan 100Mbps</p>
                <p><strong>Status:</strong> <span class="badge bg-scheduled">Scheduled</span></p>
                <p><strong>Scheduled Date:</strong> Sep 05, 2025</p>
                <div class="countdown-card mt-3">
                  <h6>Countdown to Installation:</h6>
                  <p class="countdown-text">8 days left</p>
                </div>
              </div>
            </div>
            <!-- Previous Installations -->
            <h5 class="mb-3">Previous Installations</h5>
            <div class="table-responsive">
              <table class="table table-striped">
                <thead class="table-header">
                  <tr>
                    <th>Service</th>
                    <th>Status</th>
                    <th>Installation Date</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Mobile Plan Unlimited</td>
                    <td><span class="badge bg-accepted">Completed</span></td>
                    <td>Jul 20, 2025</td>
                  </tr>
                  <tr>
                    <td>TV Package Premium</td>
                    <td><span class="badge bg-pending">Pending</span></td>
                    <td>-</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Payment Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="paymentModalLabel">Make Payment</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="cardNumber" class="form-label">Card Number</label>
            <input type="text" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456">
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="expiryDate" class="form-label">Expiry Date</label>
              <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY">
            </div>
            <div class="col-md-6 mb-3">
              <label for="cvv" class="form-label">CVV</label>
              <input type="text" class="form-control" id="cvv" placeholder="123">
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Pay</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div class="custom-modal-backdrop" *ngIf="showEditModal">
  <div class="custom-modal">
    <div class="custom-modal-header bg-primary text-white">
      <h5 class="modal-title">Edit Personal Details</h5>
      <button type="button" class="close-btn" (click)="showEditModal = false">&times;</button>
    </div>
    <div class="custom-modal-body">
      <form [formGroup]="editForm">
        <div class="mb-3">
          <label for="editName" class="form-label">Name</label>
          <input type="text" class="form-control" id="editName" formControlName="name">
          <div *ngIf="editForm.get('name')?.invalid && editForm.get('name')?.touched" class="text-danger">
            Name is required
          </div>
        </div>
        <div class="mb-3">
          <label for="editSurname" class="form-label">Surname</label>
          <input type="text" class="form-control" id="editSurname" formControlName="surname">
          <div *ngIf="editForm.get('surname')?.invalid && editForm.get('surname')?.touched" class="text-danger">
            Surname is required
          </div>
        </div>
        <div class="mb-3">
          <label for="editEmail" class="form-label">Email</label>
          <input type="email" class="form-control" id="editEmail" formControlName="email">
          <div *ngIf="editForm.get('email')?.invalid && editForm.get('email')?.touched" class="text-danger">
            Please enter a valid email
          </div>
        </div>
        <div class="mb-3">
          <label for="editPhone" class="form-label">Phone</label>
          <input type="tel" class="form-control" id="editPhone" formControlName="phone">
        </div>
        <div class="mb-3">
          <label for="editBirthdate" class="form-label">Date of Birth</label>
          <input type="date" class="form-control" id="editBirthdate" formControlName="birthdate">
        </div>
      </form>
    </div>
    <div class="custom-modal-footer">
      <button type="button" class="btn btn-secondary" (click)="showEditModal = false">Cancel</button>
      <button type="button" class="btn btn-primary" (click)="saveChanges()" [disabled]="editForm.invalid">Save</button>
    </div>
  </div>
</div>





<!-- Add/Edit Address Modal -->
<div class="custom-modal-backdrop" *ngIf="showAddAddressModal || showEditAddressModal">
  <div class="custom-modal" style="max-width: 600px;">
    <div class="custom-modal-header bg-primary text-white">
      <h5 class="modal-title">{{ userAddress ? 'Edit' : 'Add' }} Address</h5>
      <button type="button" class="close-btn" (click)="closeAddressModal()">&times;</button>
    </div>
    <div class="custom-modal-body">
      <form [formGroup]="addressForm">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="street" class="form-label">Street</label>
            <input type="text" class="form-control" id="street" formControlName="street">
          </div>
          <div class="col-md-6 mb-3">
            <label for="city" class="form-label">City</label>
            <input type="text" class="form-control" id="city" formControlName="city">
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="governorate" class="form-label">Governorate</label>
            <input type="text" class="form-control" id="governorate" formControlName="governorate">
          </div>
          <div class="col-md-6 mb-3">
            <label for="country" class="form-label">Country</label>
            <input type="text" class="form-control" id="country" formControlName="country">
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="zipCode" class="form-label">Zip Code</label>
            <input type="text" class="form-control" id="zipCode" formControlName="zipCode">
          </div>
          <div class="col-md-3 mb-3">
            <label for="latitude" class="form-label">Latitude</label>
            <input type="number" step="any" class="form-control" id="latitude" formControlName="latitude">
          </div>
          <div class="col-md-3 mb-3">
            <label for="longitude" class="form-label">Longitude</label>
            <input type="number" step="any" class="form-control" id="longitude" formControlName="longitude">
          </div>
        </div>
        
        <div class="mb-3">
          <small class="text-muted">
            <i class="fas fa-info-circle"></i> 
            You can get latitude and longitude coordinates from Google Maps
          </small>
        </div>
      </form>
    </div>
    <div class="custom-modal-footer">
      <button type="button" class="btn btn-secondary" (click)="closeAddressModal()">Cancel</button>
      <button type="button" class="btn btn-primary" (click)="saveAddress()">
        {{ userAddress ? 'Update' : 'Save' }} Address
      </button>
    </div>
  </div>
</div>